<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Unify ranger survival model — ranger_surv.unify • treeshap</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet"><link href="../dalexverse-2.css" rel="stylesheet"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Unify ranger survival model — ranger_surv.unify"><meta property="og:description" content="Convert your ranger model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in treeshap() function."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script></head><body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">treeshap</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy" class="external-link">DrWhy.AI</a>
           developed by the <a href="https://mi2.ai/" class="external-link">MI².AI</a> </span>
          <span class="version version-default">0.3.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/treeshap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Unify ranger survival model</h1>
    <small class="dont-index">Source: <a href="https://github.com/ModelOriented/treeshap/blob/HEAD/R/unify_ranger_surv.R" class="external-link"><code>R/unify_ranger_surv.R</code></a></small>
    <div class="hidden name"><code>ranger_surv.unify.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Convert your ranger model into a standardized representation.
The returned representation is easy to be interpreted by the user and ready to be used as an argument in <code><a href="treeshap.html">treeshap()</a></code> function.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ranger_surv.unify</span><span class="op">(</span></span>
<span>  <span class="va">rf_model</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"risk"</span>, <span class="st">"survival"</span>, <span class="st">"chf"</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>rf_model</dt>
<dd><p>An object of <code>ranger</code> class. At the moment, models built on data with categorical features
are not supported - please encode them before training.</p></dd>


<dt>data</dt>
<dd><p>Reference dataset. A <code>data.frame</code> or <code>matrix</code> with the same columns as in the training set of the model. Usually dataset used to train model.</p></dd>


<dt>type</dt>
<dd><p>A character to define the type of model prediction to use. Either <code>"risk"</code> (default), which uses the risk score calculated as a sum of cumulative hazard function values, <code>"survival"</code>, which uses the survival probability at certain time-points for each observation, or <code>"chf"</code>, which used the cumulative hazard values at certain time-points for each observation.</p></dd>


<dt>times</dt>
<dd><p>A numeric vector of unique death times at which the prediction should be evaluated. By default <code>unique.death.times</code> from model are used.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>For <code>type = "risk"</code> a unified model representation is returned - a <code><a href="model_unified.object.html">model_unified.object</a></code> object. For <code>type = "survival"</code> or <code>type = "chf"</code> - a <code><a href="model_unified_multioutput.object.html">model_unified_multioutput.object</a></code> object is returned, which is a list that contains unified model representation (<code><a href="model_unified.object.html">model_unified.object</a></code> object) for each time point. In this case, the list names are time points at which the survival function was evaluated.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The survival forest implemented in the <code>ranger</code> package stores cumulative hazard
functions (CHFs) in the leaves of survival trees, as proposed for Random Survival Forests
(Ishwaran et al. 2008). The final model prediction is made by averaging these CHFs
from all the trees. To provide explanations in the form of a survival function,
the CHFs from the leaves are converted into survival functions (SFs) using
the formula SF(t) = exp(-CHF(t)).
However, it is important to note that averaging these SFs does not yield the correct
model prediction as the model prediction is the average of CHFs transformed in the same way.
Therefore, when you obtain explanations based on the survival function,
they are only proxies and may not be fully consistent with the model predictions
obtained using for example <code>predict</code> function.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="ranger.unify.html">ranger.unify</a></code> for regression and classification <code><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger models</a></code></p>
<p><code><a href="lightgbm.unify.html">lightgbm.unify</a></code> for <code><a href="https://rdrr.io/pkg/lightgbm/man/lightgbm.html" class="external-link">LightGBM models</a></code></p>
<p><code><a href="gbm.unify.html">gbm.unify</a></code> for <code><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">GBM models</a></code></p>
<p><code><a href="xgboost.unify.html">xgboost.unify</a></code> for <code><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html" class="external-link">XGBoost models</a></code></p>
<p><code><a href="randomForest.unify.html">randomForest.unify</a></code> for <code><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest models</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/imbs-hl/ranger" class="external-link">ranger</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_colon</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/colon.html" class="external-link">colon</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_colon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">data_colon</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"etype"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">surv_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"status"</span>, <span class="st">"time"</span>, <span class="st">"rx"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">feature_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data_colon</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data_colon</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">train_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">.</span>,</span></span>
<span class="r-in"><span>  <span class="va">data_colon</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">feature_cols</span>, <span class="va">surv_cols</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">train_y</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  event <span class="op">=</span> <span class="op">(</span><span class="va">data_colon</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"status"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="va">data_colon</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"right"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rf</span> <span class="op">&lt;-</span> <span class="fu">ranger</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">train_x</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">train_y</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">data_colon</span>,</span></span>
<span class="r-in"><span>  max.depth <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  num.trees <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">unified_model_risk</span> <span class="op">&lt;-</span> <span class="fu">ranger_surv.unify</span><span class="op">(</span><span class="va">rf</span>, <span class="va">train_x</span>, type <span class="op">=</span> <span class="st">"risk"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="treeshap.html">treeshap</a></span><span class="op">(</span><span class="va">unified_model_risk</span>, <span class="va">train_x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |0%----|------|20%---|------|40%---|------|60%---|------|80%---|------|100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =---------------------------------------------------------------------- (0%)====================================----------------------------------- (50%)======================================================================= (100%)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compute shaps for 3 selected time points</span></span></span>
<span class="r-in"><span><span class="va">unified_model_surv</span> <span class="op">&lt;-</span> <span class="fu">ranger_surv.unify</span><span class="op">(</span><span class="va">rf</span>, <span class="va">train_x</span>, type <span class="op">=</span> <span class="st">"survival"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">23</span>, <span class="fl">50</span>, <span class="fl">73</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shaps_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="treeshap.html">treeshap</a></span><span class="op">(</span><span class="va">unified_model_surv</span>, <span class="va">train_x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |0%----|------|20%---|------|40%---|------|60%---|------|80%---|------|100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =---------------------------------------------------------------------- (0%)====================================----------------------------------- (50%)======================================================================= (100%)|0%----|------|20%---|------|40%---|------|60%---|------|80%---|------|100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =---------------------------------------------------------------------- (0%)====================================----------------------------------- (50%)======================================================================= (100%)|0%----|------|20%---|------|40%---|------|60%---|------|80%---|------|100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =---------------------------------------------------------------------- (0%)====================================----------------------------------- (50%)======================================================================= (100%)</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Konrad Komisarczyk, Pawel Kozminski, Szymon Maksymiuk, Mateusz Krzyzinski, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  </body></html>

