<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Compute SHAP Values for Your Tree-Based Models Using the TreeSHAP
    Algorithm • treeshap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="dalexverse.css" rel="stylesheet">
<link href="dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Compute SHAP Values for Your Tree-Based Models Using the TreeSHAP
    Algorithm">
<meta property="og:description" content="An efficient implementation of the TreeSHAP algorithm
    introduced by Lundberg et al., (2020) &lt;doi:10.1038/s42256-019-0138-9&gt;.
    It is capable of calculating SHAP values for tree-based models in
    polynomial time.  Currently supported models include 
    gbm, randomForest, ranger, xgboost, lightgbm.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="index.html">treeshap</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy" class="external-link">DrWhy.AI</a>
           developed by the <a href="https://mi2.ai/" class="external-link">MI².AI</a> </span>
          <span class="version version-default">0.2.3</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/treeshap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="treeshap">treeshap<a class="anchor" aria-label="anchor" href="#treeshap"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>In the era of complicated classifiers conquering their market, sometimes even the authors of algorithms do not know the exact manner of building a tree ensemble model. The difficulties in models’ structures are one of the reasons why most users use them simply like black-boxes. But, how can they know whether the prediction made by the model is reasonable? <code>treeshap</code> is an efficient answer for this question. Due to implementing an optimized algorithm for tree ensemble models (called TreeSHAP), it calculates the SHAP values in polynomial (instead of exponential) time. Currently, <code>treeshap</code> supports models produced with <code>xgboost</code>, <code>lightgbm</code>, <code>gbm</code>, <code>ranger</code>, and <code>randomForest</code> packages. Support for <code>catboost</code> is available only in <a href="https://github.com/ModelOriented/treeshap/tree/catboost" class="external-link"><code>catboost</code> branch</a> (see why <a href="#catboost">here</a>).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The package is available on CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'treeshap'</span><span class="op">)</span></span></code></pre></div>
<p>You can install the latest development version from GitHub using <code>devtools</code> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'ModelOriented/treeshap'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>First of all, let’s focus on an example how to represent a <code>xgboost</code> model as a unified model object:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/treeshap/" class="external-link">treeshap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost" class="external-link">xgboost</a></span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">fifa20</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fifa20</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'work_rate'</span><span class="op">]</span></span>
<span><span class="va">target</span> <span class="op">&lt;-</span> <span class="va">fifa20</span><span class="op">$</span><span class="va">target</span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>objective <span class="op">=</span> <span class="st">"reg:squarederror"</span>, max_depth <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">xgb_model</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html" class="external-link">xgboost</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, params <span class="op">=</span> <span class="va">param</span>, label <span class="op">=</span> <span class="va">target</span>, nrounds <span class="op">=</span> <span class="fl">200</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">unified</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/unify.html">unify</a></span><span class="op">(</span><span class="va">xgb_model</span>, <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">unified</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Tree Node   Feature Decision.type Split Yes No Missing Prediction Cover</span></span>
<span><span class="co">#&gt; 1    0    0   overall            &lt;=  81.5   2  3       2         NA 18278</span></span>
<span><span class="co">#&gt; 2    0    1   overall            &lt;=  73.5   4  5       4         NA 17949</span></span>
<span><span class="co">#&gt; 3    0    2   overall            &lt;=  84.5   6  7       6         NA   329</span></span>
<span><span class="co">#&gt; 4    0    3   overall            &lt;=  69.5   8  9       8         NA 15628</span></span>
<span><span class="co">#&gt; 5    0    4 potential            &lt;=  79.5  10 11      10         NA  2321</span></span>
<span><span class="co">#&gt; 6    0    5 potential            &lt;=  83.5  12 13      12         NA   221</span></span></code></pre></div>
<p>Having the object of unified structure, it is a piece of cake to produce SHAP values for a specific observation. The <code><a href="reference/treeshap.html">treeshap()</a></code> function requires passing two data arguments: one representing an ensemble model unified representation and one with the observations about which we want to get the explanations. Obviously, the latter one should contain the same columns as data used during building the model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treeshap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/treeshap.html">treeshap</a></span><span class="op">(</span><span class="va">unified</span>,  <span class="va">data</span><span class="op">[</span><span class="fl">700</span><span class="op">:</span><span class="fl">800</span>, <span class="op">]</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">treeshap1</span><span class="op">$</span><span class="va">shaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt;            age height_cm weight_kg overall potential international_reputation</span></span>
<span><span class="co">#&gt; 700   297154.4  5769.186 12136.316 8739757  212428.8               -50855.738</span></span>
<span><span class="co">#&gt; 701 -2550066.6 16011.136  3134.526 6525123  244814.2                22784.430</span></span>
<span><span class="co">#&gt; 702   300830.3 -9023.299 15374.550 8585145  479118.8                 2374.351</span></span></code></pre></div>
<p>We can also compute SHAP values for interactions. As an example we will calculate them for a model built with simpler (only 5 columns) data and first 100 observations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="va">fifa20</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="va">xgb_model2</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html" class="external-link">xgboost</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span>, params <span class="op">=</span> <span class="va">param</span>, label <span class="op">=</span> <span class="va">target</span>, nrounds <span class="op">=</span> <span class="fl">200</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">unified2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/unify.html">unify</a></span><span class="op">(</span><span class="va">xgb_model2</span>, <span class="va">data2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">treeshap_interactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/treeshap.html">treeshap</a></span><span class="op">(</span><span class="va">unified2</span>,  <span class="va">data2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="op">]</span>, interactions <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">treeshap_interactions</span><span class="op">$</span><span class="va">interactions</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; , , 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                   age  height_cm  weight_kg     overall  potential</span></span>
<span><span class="co">#&gt; age       -1886241.70   -3984.09  -96765.97   -47245.92  1034657.6</span></span>
<span><span class="co">#&gt; height_cm    -3984.09 -628797.41  -35476.11  1871689.75   685472.2</span></span>
<span><span class="co">#&gt; weight_kg   -96765.97  -35476.11 -983162.25  2546930.16  1559453.5</span></span>
<span><span class="co">#&gt; overall     -47245.92 1871689.75 2546930.16 55289985.16 12683135.3</span></span>
<span><span class="co">#&gt; potential  1034657.61  685472.23 1559453.46 12683135.27   868268.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  age  height_cm  weight_kg    overall  potential</span></span>
<span><span class="co">#&gt; age       -2349987.9  306165.41  120483.91 -9871270.0  960198.02</span></span>
<span><span class="co">#&gt; height_cm   306165.4  -78810.31  -48271.61  -991020.7  -44632.74</span></span>
<span><span class="co">#&gt; weight_kg   120483.9  -48271.61  -21657.14  -615688.2 -380810.70</span></span>
<span><span class="co">#&gt; overall   -9871270.0 -991020.68 -615688.21 57384425.2 9603937.05</span></span>
<span><span class="co">#&gt; potential   960198.0  -44632.74 -380810.70  9603937.1 2994190.74</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting-results">Plotting results<a class="anchor" aria-label="anchor" href="#plotting-results"></a>
</h2>
<p>The explanation results can be visualized using <a href="https://github.com/ModelOriented/shapviz/" class="external-link"><code>shapviz</code></a> package, see <a href="https://modeloriented.github.io/shapviz/articles/basic_use.html#treeshap" class="external-link">here</a>.</p>
<p>However, <code>treeshap</code> also provides 4 plotting functions:</p>
<div class="section level3">
<h3 id="feature-contribution-break-down">Feature Contribution (Break-Down)<a class="anchor" aria-label="anchor" href="#feature-contribution-break-down"></a>
</h3>
<p>On this plot we can see how features contribute into the prediction for a single observation. It is similar to the Break Down plot from <a href="https://github.com/ModelOriented/iBreakDown" class="external-link">iBreakDown</a> package, which uses different method to approximate SHAP values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_contribution.html">plot_contribution</a></span><span class="op">(</span><span class="va">treeshap1</span>, obs <span class="op">=</span> <span class="fl">1</span>, min_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">16000000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_contribution_example-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="feature-importance">Feature Importance<a class="anchor" aria-label="anchor" href="#feature-importance"></a>
</h3>
<p>This plot shows us average absolute impact of features on the prediction of the model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_feature_importance.html">plot_feature_importance</a></span><span class="op">(</span><span class="va">treeshap1</span>, max_vars <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_importance_example-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="feature-dependence">Feature Dependence<a class="anchor" aria-label="anchor" href="#feature-dependence"></a>
</h3>
<p>Using this plot we can see, how a single feature contributes into the prediction depending on its value.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_feature_dependence.html">plot_feature_dependence</a></span><span class="op">(</span><span class="va">treeshap1</span>, <span class="st">"height_cm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_dependence_example-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="interaction-plot">Interaction Plot<a class="anchor" aria-label="anchor" href="#interaction-plot"></a>
</h3>
<p>Simple plot to visualize an SHAP Interaction value of two features depending on their values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_interaction.html">plot_interaction</a></span><span class="op">(</span><span class="va">treeshap_interactions</span>, <span class="st">"height_cm"</span>, <span class="st">"overall"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_interaction-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="how-to-use-the-unifying-functions">How to use the unifying functions?<a class="anchor" aria-label="anchor" href="#how-to-use-the-unifying-functions"></a>
</h2>
<p>For your convenience, you can now simply use the <code><a href="reference/unify.html">unify()</a></code> function by specifying your model and reference dataset. Behind the scenes, it uses one of the six functions from the <code>.unify()</code> family (<code><a href="reference/xgboost.unify.html">xgboost.unify()</a></code>, <code><a href="reference/lightgbm.unify.html">lightgbm.unify()</a></code>, <code><a href="reference/gbm.unify.html">gbm.unify()</a></code>, <code>catboost.unify()</code>, <code><a href="reference/randomForest.unify.html">randomForest.unify()</a></code>, <code><a href="reference/ranger.unify.html">ranger.unify()</a></code>). Even though the objects produced by these functions are identical when it comes to the structure, due to different possibilities of saving and representing the trees among the packages, the usage of these model-specific functions may be slightly different. Therefore, you can use them independently or pass some additional parameters to <code><a href="reference/unify.html">unify()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/treeshap/" class="external-link">treeshap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gbm-developers/gbm" class="external-link">gbm</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">fifa20</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fifa20</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'work_rate'</span><span class="op">]</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="st">'value_eur'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fifa20</span><span class="op">$</span><span class="va">target</span></span>
<span><span class="va">gbm_model</span> <span class="op">&lt;-</span> <span class="fu">gbm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">value_eur</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">x</span>,</span>
<span>  distribution <span class="op">=</span> <span class="st">"laplace"</span>,</span>
<span>  n.trees <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  cv.folds <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  interaction.depth <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">unified_gbm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/unify.html">unify</a></span><span class="op">(</span><span class="va">gbm_model</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">unified_gbm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gbm.unify.html">gbm.unify</a></span><span class="op">(</span><span class="va">gbm_model</span>, <span class="va">x</span><span class="op">)</span> <span class="co"># legacy API</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-reference-dataset">Setting reference dataset<a class="anchor" aria-label="anchor" href="#setting-reference-dataset"></a>
</h2>
<p>Dataset used as a reference for calculating SHAP values is stored in unified model representation object. It can be set any time using <code><a href="reference/set_reference_dataset.html">set_reference_dataset()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/treeshap/" class="external-link">treeshap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/imbs-hl/ranger" class="external-link">ranger</a></span><span class="op">)</span></span>
<span><span class="va">data_fifa</span> <span class="op">&lt;-</span> <span class="va">fifa20</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fifa20</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'work_rate'</span>, <span class="st">'value_eur'</span>, <span class="st">'gk_diving'</span>, <span class="st">'gk_handling'</span>,</span>
<span>                              <span class="st">'gk_kicking'</span>, <span class="st">'gk_reflexes'</span>, <span class="st">'gk_speed'</span>, <span class="st">'gk_positioning'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data_fifa</span>, target <span class="op">=</span> <span class="va">fifa20</span><span class="op">$</span><span class="va">target</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rf</span> <span class="op">&lt;-</span> <span class="fu">ranger</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger</a></span><span class="op">(</span><span class="va">target</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">data</span>, max.depth <span class="op">=</span> <span class="fl">10</span>, num.trees <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">unified_ranger_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/unify.html">unify</a></span><span class="op">(</span><span class="va">rf</span>, <span class="va">data</span><span class="op">)</span></span>
<span><span class="va">unified_ranger_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/set_reference_dataset.html">set_reference_dataset</a></span><span class="op">(</span><span class="va">unified_ranger_model</span>, <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">:</span><span class="fl">2000</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-functionalities">Other functionalities<a class="anchor" aria-label="anchor" href="#other-functionalities"></a>
</h2>
<p>Package also implements <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function for calculating model’s predictions using unified representation.</p>
</div>
<div class="section level2">
<h2 id="how-fast-does-it-work">How fast does it work?<a class="anchor" aria-label="anchor" href="#how-fast-does-it-work"></a>
</h2>
<p>The complexity of TreeSHAP is <span class="math inline">𝒪(<em>T</em><em>L</em><em>D</em><sup>2</sup>)</span>, where <span class="math inline"><em>T</em></span> is the number of trees, <span class="math inline"><em>L</em></span> is the number of leaves in a tree, and <span class="math inline"><em>D</em></span> is the depth of a tree.</p>
<p>Our implementation works at a speed comparable to the original Lundberg’s Python package <code>shap</code> implementation using C and Python.</p>
<p>The complexity of SHAP interaction values computation is <span class="math inline">𝒪(<em>M</em><em>T</em><em>L</em><em>D</em><sup>2</sup>)</span>, where <span class="math inline"><em>M</em></span> is the number of explanatory variables used by the explained model, <span class="math inline"><em>T</em></span> is the number of trees, <span class="math inline"><em>L</em></span> is the number of leaves in a tree, and <span class="math inline"><em>D</em></span> is the depth of a tree.</p>
</div>
<div class="section level2">
<h2 id="catboost">CatBoost<a class="anchor" aria-label="anchor" href="#catboost"></a>
</h2>
<p>Originally, <code>treeshap</code> also supported the CatBoost models from the <code>catboost</code> package but due to the lack of this package on CRAN or R-universe (see <code>catboost</code> issues issues <a href="https://github.com/catboost/catboost/issues/439" class="external-link">#439</a>, <a href="https://github.com/catboost/catboost/issues/1846" class="external-link">#1846</a>), we decided to remove support from the main version of our package.</p>
<p>However, you can still use the <code>treeshap</code> implementation for <code>catboost</code> by installing our package from <a href="https://github.com/ModelOriented/treeshap/tree/catboost" class="external-link"><code>catboost</code> branch</a>.</p>
<p>This branch can be installed with:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'ModelOriented/treeshap@catboost'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Lundberg, S.M., Erion, G., Chen, H. et al. “From local explanations to global understanding with explainable AI for trees”, Nature Machine Intelligence 2, 56–67 (2020).</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ModelOriented/treeshap/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ModelOriented/treeshap/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing treeshap</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Konrad Komisarczyk <br><small class="roles"> Author </small>  </li>
<li>Pawel Kozminski <br><small class="roles"> Author </small>  </li>
<li>Szymon Maksymiuk <br><small class="roles"> Author </small>  </li>
<li>Mateusz Krzyzinski <br><small class="roles"> Contributor, maintainer </small>  </li>
<li>Przemyslaw Biecek <br><small class="roles"> Author, copyright holder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Konrad Komisarczyk, Pawel Kozminski, Szymon Maksymiuk, Mateusz Krzyzinski, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
